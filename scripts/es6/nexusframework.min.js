Object.defineProperties(window,{NexusFrameworkTransport:{configurable:!0,set:function(e){Object.defineProperty(window,"NexusFrameworkTransport",{value:e})},get:function(){var e;if("XMLHttpRequest"in window){class t{constructor(e,t){this._url=t,this.request=e,e.responseType="arraybuffer"}get url(){return this.request.responseURL||this._url}get code(){return this.request.status}get contentFromJSON(){return this.parsedJson||(this.parsedJson=JSON.parse(this.request.responseText)),this.parsedJson}get contentAsArrayBuffer(){return this.request.response}get contentAsString(){return this.request.responseText}get headers(){if(!this.processedHeaders){const e=this.processedHeaders={};this.request.getAllResponseHeaders().split(/\r?\n/g).forEach(function(t){const r=t.indexOf(":");var s,o;r>0?(s=t.substring(0,r).trim().toLowerCase(),o=t.substring(r+1).trim()):s=t.trim().toLowerCase();var n=e[s];n||(n=e[s]=[]),o&&n.push(o)})}return this.processedHeaders}}const r=function(e,r,s,o,n,a){const i=new XMLHttpRequest;i.open(e,r,!0),Object.keys(n).forEach(function(e){i.setRequestHeader(e,n[e])}),a&&(i.onprogress=function(e){e.lengthComputable&&e.total&&a(e.loaded,e.total)}),i.onreadystatechange=function(e){i.readyState===XMLHttpRequest.DONE&&o(new t(i,r))},i.send(s)};e={get:function(e,t,s,o){r("GET",e,void 0,t,s,o)},head:function(e,t,s,o){r("HEAD",e,void 0,t,s,o)},post:function(e,t,s,o,n){r("POST",e,t,s,o,n)},put:function(e,t,s,o,n){r("PUT",e,t,s,o,n)},execute:r,del:function(e,t,s,o){r("DELETE",e,void 0,t,s,o)}}}else e={get(e,t,r){t({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsArrayBuffer:new ArrayBuffer(0),contentAsString:"",headers:{}})},head(e,t,r){t({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsArrayBuffer:new ArrayBuffer(0),contentAsString:"",headers:{}})},put(e,t,r,s){r({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsArrayBuffer:new ArrayBuffer(0),contentAsString:"",headers:{}})},post(e,t,r,s){r({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsArrayBuffer:new ArrayBuffer(0),contentAsString:"",headers:{}})},execute(e,t,r,s,o){s({url:t,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsArrayBuffer:new ArrayBuffer(0),contentAsString:"",headers:{}})},del(e,t,r){t({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsArrayBuffer:new ArrayBuffer(0),contentAsString:"",headers:{}})}};return Object.defineProperty(window,"NexusFrameworkTransport",{value:e}),e}},NexusFrameworkImpl:{configurable:!0,set:function(e){Object.defineProperty(window,"NexusFrameworkImpl",{value:e})},get:function(){const e=function(){},t={reportError:e,reportEvent:e,reportPage:e},r=document.createElement("a"),s=location.href.match(/^\w+:/)[0],o=function(e){r.setAttribute("href",e);var t=r.href;return/^\/\//.test(t)&&(t=s+t),t},n=function(e,t){e.addEventListener("transitionend",t),e.addEventListener("transitionEnd",t),e.addEventListener("webkitTransitionEnd",t),e.addEventListener("mozTransitionEnd",t),e.addEventListener("oTransitionEnd",t)},a=function(e,t){e.removeEventListener("transitionend",t),e.removeEventListener("transitionEnd",t),e.removeEventListener("webkitTransitionEnd",t),e.removeEventListener("mozTransitionEnd",t),e.removeEventListener("oTransitionEnd",t)},i=function(e,t=location.href){var r,s;return"string"==typeof e.data||e.data instanceof String?{url:t,code:e.code,contentAsString:e.data,get contentAsArrayBuffer(){if(!s){s=new ArrayBuffer(e.data.length);for(var t=new Uint8Array(s),r=0,o=e.data.length;r<o;r++)t[r]=e.data.charCodeAt(r)}return s},get contentFromJSON(){return r||(r=JSON.parse(e.data)),r},headers:e.headers}:{url:t,code:e.code,get contentAsString(){return r||(r=JSON.stringify(e.data)),r},get contentAsArrayBuffer(){if(!s){r||(r=JSON.stringify(e.data)),s=new ArrayBuffer(r);for(var t=new Uint8Array(s),o=0,n=r.length;o<n;o++)t[o]=r.charCodeAt(o)}return s},contentFromJSON:e.data,headers:e.headers}},c=/(^|\s)loader\-(progress|error)\-container(\s|$)/;class l{constructor(e="/",r){this.activerid=0,this.components={},this.currentUserID=void 0,this.progressBar=document.getElementsByClassName("loader-progress-bar"),this.progressBarContainer=document.getElementsByClassName("loader-progress-container"),this.progressVisible=!1,this.requestPage=this.defaultRequestPage,e=o(e),/\/$/.test(e)||(e+="/"),Object.defineProperties(this,{io:{value:r},url:{value:e}}),window.ga?this._analytics={reportError:function(e,t){try{window.ga("send","exception",{exDescription:e+"\n\t"+(e.stack||"Stack trace not available").replace(/\n/g,"\n\t"),exFatal:!0})}catch(e){console.warn(e)}},reportEvent:function(e,t,r,s){try{window.ga("send","event",e,t,r,s)}catch(e){console.warn(e)}},reportPage:function(e,t){try{window.ga("send","pageview",e,{page:e,title:t})}catch(e){console.warn(e)}}}:this._analytics=t}resolveUrl(e){return/^\w+\:/.test(e)?e:o(this.url+e)}disableAll(e=document.body){const t=e.querySelectorAll("a, input, select, textarea, iframe, button, *[focusable], *[tabindex]");for(var r=0;r<t.length;r++){const e=t[r],s=e.getAttribute("tabindex");if("-1"==s)return;e.setAttribute("data-tabindex",s||""),e.setAttribute("data-tabindex","-1")}}enableAll(e=document.body){const t=e.querySelectorAll("*[data-tabindex]");for(var r=0;r<t.length;r++){const e=t[r];e.setAttribute("tabindex",e.getAttribute("data-tabindex")),e.removeAttribute("data-tabindex")}}fadeInProgress(e){if(this.progressVisible)e&&e();else if(this.progressFadeCallbacks)e&&this.progressFadeCallbacks.push(e);else{for(r=0;r<this.progressBar.length;r++)this.progressBar[r].style.width="0%";if(this.progressBarContainer.length){var t;this.progressFadeCallbacks=[],e&&this.progressFadeCallbacks.push(e);const s=this.progressBarContainer[0],o=()=>{try{clearTimeout(t)}catch(e){}a(s,o),this.progressVisible=!0;const e=this.progressFadeCallbacks;delete this.progressFadeCallbacks,e.forEach(function(e){e()})};n(s,o),t=setTimeout(o,500);for(var r=0;r<this.progressBarContainer.length;r++){const e=this.progressBarContainer[r];/(^|\s)loader\-progress\-visible(\s|$)/.test(e.className)||(e.className=(e.className+" loader-progress-visible").trim())}}else this.progressVisible=!0,e&&e()}}fadeOutProgress(e){if(this.progressVisible)if(this.progressFadeCallbacks)e&&this.progressFadeCallbacks.push(e);else{for(r=0;r<this.progressBar.length;r++)this.progressBar[r].style.width="100%";if(this.progressBarContainer.length){var t;this.progressFadeCallbacks=[],e&&this.progressFadeCallbacks.push(e);const s=this.progressBarContainer[0],o=()=>{try{clearTimeout(t)}catch(e){}a(s,o),this.progressVisible=!1;const e=this.progressFadeCallbacks;delete this.progressFadeCallbacks,e.forEach(function(e){e()})};n(s,o),t=setTimeout(o,500);for(var r=0;r<this.progressBarContainer.length;r++){const e=this.progressBarContainer[r];e.className=e.className.replace(/(^|\s)loader\-progress\-visible(\s|$)/g,function(e){return/^\s.+\s$/.test(e)?" ":""})}}else this.progressVisible=!1,e&&e()}else e&&e()}get analytics(){return this._analytics}set analytics(e){this._analytics=e||t}reportError(e,t){this.errorreporter&&this.errorreporter(e,t)}installErrorReporter(e){this.errorreporter=e}registerComponent(e,t){if(t)this.components[e]=t,this.createComponents(document.head),this.createComponents(document.body);else{delete this.components[e];var r=t=>{const r=t.querySelectorAll(e);if(r.length)for(var s=0;s<r.length;s++){const t=r[s];var o=t.__nf_cmapping__;o||(o=t.__nf_cmapping__={});const n=o[e];if(n)try{n.destroy()}catch(e){this.reportError(e)}}};r(document.head),r(document.body)}}unregisterComponent(e,t){}createComponents(e){Object.keys(this.components).forEach(t=>{const r=e.querySelectorAll(t);if(r.length)for(var s=0;s<r.length;s++){const e=r[s];var o=e.__nf_cmapping__;if(o||(o=e.__nf_cmapping__={}),o[t])continue;const n=this.components[t];try{(o[t]=new n).create(e)}catch(e){this.reportError(e)}}})}destroyComponents(e){Object.keys(this.components).forEach(t=>{const r=e.querySelectorAll(t);if(r.length)for(var s=0;s<r.length;s++){const e=r[s];var o=e.__nf_cmapping__;o||(o=e.__nf_cmapping__={});const n=o[t];if(n)try{n.destroy()}catch(e){this.reportError(e)}}})}restoreComponents(e,t){Object.keys(this.components).forEach(r=>{const s=t[r];if(!s)return;const o=e.querySelectorAll(r);if(o.length)for(var n=0;n<o.length;n++){const e=o[n];if(!s.length)break;{const t=s.shift();if(t){var a=e.__nf_cmapping__;a||(a=e.__nf_cmapping__={});var i=a[r];if(!i){const t=this.components[r];try{(i=a[r]=new t).create(e)}catch(e){this.reportError(e),console.warn(e);continue}}try{i.restore(t)}catch(e){this.reportError(e),console.warn(e)}}}}})}saveComponents(e){var t={};return Object.keys(this.components).forEach(r=>{const s=t[r]=[],o=e.querySelectorAll(r);if(o.length)for(var n=0;n<o.length;n++){const e=o[n];var a=e.__nf_cmapping__;a||(a=e.__nf_cmapping__={});var i=a[r];if(!i){const t=this.components[r];try{(i=a[r]=new t).create(e)}catch(e){s.push(void 0),this.reportError(e),console.warn(e);continue}}try{s.push(i.save())}catch(e){s.push(void 0),this.reportError(e),console.warn(e)}}}),t}initPageSystem(e){if(!window.NexusFrameworkLoader)return console.warn("The NexusFramework Loader is required for the dynamic Page System to work correctly.");if(!history.pushState||!history.replaceState)return console.warn("This browser is missing an essential feature required for the dynamic Page System.");const t=this;var r;const s=e=>t=>{const r=t.headers["x-user"];this.currentUserID=r?r[0]:void 0,e(t)},n={requestPage(r,o,n,a){if(t.pagesysprerequest&&!t.pagesysprerequest(r))return void t.defaultRequestPage(r,n);e.noprogress||(t.disableAll(),t.fadeInProgress());const i=t.resolveUrl(r),c={accepts:"text/json"},l=e.noprogress?o:function(e){t.fadeInProgress(()=>{o(e),t.enableAll()})};n?window.NexusFrameworkTransport.post(i,n,s(l),c):window.NexusFrameworkTransport.get(i,s(l),c)}};if(!(e=e||{}).noio&&this.io){const r=this.io;this.pagesysimpl={requestPage(o,a,c,l){if(r.connected){if(t.pagesysprerequest&&!t.pagesysprerequest(o))return void t.defaultRequestPage(o,c);e.noprogress||(t.disableAll(),t.fadeInProgress());const n={referrer:location.href};var d=document.cookie;d&&(n.cookie=d),r.emit("page",c?"POST":"GET",o,c,n,function(r){if(l!=t.activerid)return;const n=r.headers["set-cookie"];n&&n.forEach(function(e){document.cookie=e});const c=e.noprogress?a:function(e){t.fadeInProgress(()=>{a(e),t.enableAll()})};s(c)(i(r,t.resolveUrl(o)))})}else n.requestPage(o,a,c,l)}}}else this.pagesysimpl=n;var a=document.getElementsByTagName("base");a=a&&a[0],this.pagesysprerequest=e.prerequest,this.pagesyshandler=e.handler||(e=>{try{const t=e.headers["content-type"][0];if(!/\/html(;.+)?$/.test(t.toLowerCase()))throw new Error("Content type is not html")}catch(e){}const t=e.contentAsString,r=t.indexOf("<body");if(-1==r)throw new Error("Could not find start of body tag");const s=t.indexOf("</body>")||t.indexOf("</ body>");if(-1==s)throw new Error("Could not find end of body tag");const o=t.match(/<title>([^<]+)<\/\s*title>/);document.title=o&&o[1]||"Title Not Set";const n=document.createElement("html");n.innerHTML=t.substring(r,s)+"</body>";var a,i=n.children;const l=[];for(d=0;d<i.length;d++){const e=i[d];switch(e.nodeName.toUpperCase()){case"HEAD":break;case"BODY":d=-1,i=e.children;break;case"SCRIPT":const t=e.innerHTML.match(/^NexusFrameworkLoader\.load\((.+)\);?$/);t&&(a=JSON.parse(t[1]));break;default:if(c.test(e.className))break;l.push(e)}}if(!l.length)throw new Error("Nothing found in response to add to page");if(!a)throw new Error("NexusFrameworkLoader script not found...");for(var d=(i=document.body.children).length-1;d>=0;d--){const e=i[d];switch(e.nodeName.toUpperCase()){case"SCRIPT":break;default:if(c.test(e.className))break;document.body.removeChild(e)}}return l.forEach(function(e){document.body.appendChild(e)}),window.NexusFrameworkLoader.load(a,this.fadeOutProgress.bind(this)),!0});var l;const d=new RegExp("^"+this.url.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"(.*)$","i");class h{constructor(){this.handler=(e=>{if(!this.element.hasAttribute("data-nopagesys")&&!this.element.hasAttribute("data-nodynamic")){var r=this.element.href;if(d.test(r))try{const s=r.match(/^(.+)#.*$/);s&&(r=s[1]),t.requestPage(r.substring(t.url.length));try{e.stopPropagation()}catch(e){}try{e.preventDefault()}catch(e){}}catch(e){console.warn(e)}else console.log("Navigating",r)}})}create(e){e.addEventListener("click",this.handler),this.element=e}destroy(){this.element.removeEventListener("click",this.handler)}restore(e){}save(){}}const u=e=>{if(e)return{title:document.title,user:this.currentUserID,scroll:[window.scrollX,window.scrollY],body:this.saveComponents(document.body),basehref:a?a.href:void 0,page:e}};return this.requestPage=((e,t,s=!1)=>{if(/\..+$/.test(e))this.defaultRequestPage(e,t);else{const n=++this.activerid,a=this.resolveUrl(e);console.log(a,s,n),s?history.replaceState(u(r),"Loading...",a):(history.replaceState(u(r),document.title,location.href),history.pushState(u(),"Loading...",a),r=void 0,window.scrollTo(0,0)),this.pagesysimpl.requestPage(e,s=>{try{if(n!=this.activerid)return;const i=s.headers.location;if(i){const e=o(i[0]);return d.test(e)?void this.requestPage(e.substring(this.url.length),void 0,!0):(console.warn("Requested redirect to url outside of website:",e),void(window.location.href=e))}const c=s.headers["content-disposition"];if(c&&"attachment"==c[0].toLowerCase())throw new Error("Attachment disposition");if(!this.pagesyshandler(s))throw new Error("Could not handle response");const h=s.headers["content-type"];history.replaceState(u(r={code:s.code,headers:s.headers,data:h&&/\/json(;.+)?$/.test(h[0])?s.contentFromJSON:s.contentAsString}),document.title,a)}catch(r){console.warn(r),l=[e,t];try{history.go(-1)}catch(e){}}},t,n)}}),this.registerComponent("a",h),window.addEventListener("popstate",e=>{if(l){const e=l;return setTimeout(()=>{this.defaultRequestPage(e[0],e[1])}),void(l=void 0)}try{if(!e.state)throw new Error("No state, reloading...");if(e.state.user!=this.currentUserID)throw new Error("User has changed since state was created, reloading...");const s=e.state.page;if(!s)throw new Error("Page was never loaded or page data is corrupt, reloading...");document.title=e.state.title,this.pagesyshandler(i(s)),this.restoreComponents(document.body,e.state.body),window.scrollTo.apply(window,e.state.scroll)}catch(s){console.warn(s);var r=location.href;if(d.test(r))try{if(/reloading\.\.\.$/.test(s.message))return void this.requestPage(r.substring(t.url.length),void 0,!0);console.error("Unknown error occured, actually navigating to page...")}catch(e){console.error(e)}location.reload(!0)}}),!0}defaultRequestPage(e,t){if(t)throw new Error("Posting is not supported without an initialized page system, yet");location.href=this.resolveUrl(e)}}var d;return d=window.io?class extends l{constructor(e){super(e,window.io({path:"/:io"}));const t=this.io;t.on("connect",function(){t.emit("init",window.NexusFrameworkLoader.requestedResources())})}}:class extends l{constructor(e){super(e)}},Object.defineProperty(window,"NexusFrameworkImpl",{value:d}),d}},NexusFramework:{configurable:!0,set:function(e){Object.defineProperty(window,"NexusFramework",{value:e})},get:function(){const e=new window.NexusFrameworkImpl;return Object.defineProperty(window,"NexusFramework",{value:e}),e}}});
//# sourceMappingURL=nexusframework.min.js.map