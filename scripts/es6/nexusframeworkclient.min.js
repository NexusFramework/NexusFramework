Object.defineProperties(window,{NexusFrameworkTransport:{configurable:!0,set:function(e){Object.defineProperty(window,"NexusFrameworkTransport",{value:e})},get:function(){var e;if("XMLHttpRequest"in window){class t{constructor(e,t,r){this._url=t,this.request=e,this.hadData=r}get url(){return this.request.responseURL||this._url}get code(){return this.request.status}get contentLength(){return parseInt(this.request.getResponseHeader("content-length"))||this.request.responseText.length}get contentFromJSON(){return this.parsedJson||(this.parsedJson=JSON.parse(this.request.responseText)),this.parsedJson}get contentAsString(){return this.request.responseText}get headers(){if(!this.processedHeaders){const e=this.processedHeaders={};this.request.getAllResponseHeaders().split(/\r?\n/g).forEach(function(t){const r=t.indexOf(":");var o,n;r>0?(o=t.substring(0,r).trim().toLowerCase(),n=t.substring(r+1).trim()):o=t.trim().toLowerCase();var s=e[o];s||(s=e[o]=[]),n&&s.push(n)})}return this.processedHeaders}}const r=function(e,r,o,n,s,a){const i=new XMLHttpRequest;i.open(e,r,!0),s&&Object.keys(s).forEach(function(e){i.setRequestHeader(e,s[e])}),a&&(i.onprogress=function(e){e.lengthComputable&&e.total&&a(e.loaded,e.total)}),i.onreadystatechange=function(e){i.readyState===XMLHttpRequest.DONE&&n(new t(i,r,!!o))};const c=o&&o.type;if(c)switch(c){case"":case"text/urlencoded":var d="";for(var l of o.data)d&&(d+="&"),d+=encodeURIComponent(l[0]),d+="=",d+=encodeURIComponent(l[1]);i.setRequestHeader("Content-Type","text/urlencoded"),i.send(d);break;case"multipart/form-data":i.send(o.data);break;default:i.send(o)}else i.send(o)};e={get:function(e,t,o,n){r("GET",e,void 0,t,o,n)},head:function(e,t,o,n){r("HEAD",e,void 0,t,o,n)},post:function(e,t,o,n,s){r("POST",e,t,o,n,s)},put:function(e,t,o,n,s){r("PUT",e,t,o,n,s)},execute:r,del:function(e,t,o,n){r("DELETE",e,void 0,t,o,n)}}}else e={get(e,t,r){t({url:e,code:0,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},head(e,t,r){t({url:e,code:0,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},put(e,t,r,o){r({url:e,code:0,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},post(e,t,r,o){r({url:e,code:0,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},execute(e,t,r,o,n){o({url:t,code:0,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},del(e,t,r){t({url:e,code:0,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})}};return Object.defineProperty(window,"NexusFrameworkTransport",{value:e}),e}},NexusFrameworkImpl:{configurable:!0,set:function(e){Object.defineProperty(window,"NexusFrameworkImpl",{value:e})},get:function(){const e=window.NexusFrameworkLoader,t=e.showError,r=console.log.bind(console),o={reportError:function(e,t){if(window.ga)try{window.ga("send","exception",{exDescription:(e.stack||""+e).replace(/\n/g,"\n\t"),exFatal:t})}catch(e){console.warn(e)}},reportEvent:function(e,t,r,o){if(window.ga)try{window.ga("send","event",e,t,r,o)}catch(e){console.warn(e)}},reportPage:function(e){if(window.ga)try{e||(e=location.pathname),window.ga("set","page",e),window.ga("send","pageview")}catch(e){console.warn(e)}}},n=document.createElement("a"),s=location.href.match(/^\w+:/)[0],a=function(e){n.setAttribute("href",e);var t=n.href;return/^\/\//.test(t)&&(t=s+t),t},i=function(e,t=location.href){var r;return"string"==typeof e.data||e.data instanceof String?{url:t,code:e.code,contentAsString:e.data,get contentLength(){return parseInt(e.headers["content-length"]&&e.headers["content-length"][0])||e.data.length},get contentFromJSON(){return r||(r=JSON.parse(e.data)),r},headers:e.headers}:{url:t,code:e.code,get contentAsString(){return r||(r=JSON.stringify(e.data)),r},contentFromJSON:e.data,headers:e.headers,get contentLength(){var t=parseInt(e.headers["content-length"]&&e.headers["content-length"][0]);return t||(r||(r=JSON.stringify(e.data)),r.length)}}},c=/(^|\s)loader\-(progress|error)\-container(\s|$)/;class d{constructor(e="/",t){this.activerid=0,this.components={},this.currentUserID=void 0,this.progressVisible=!1,this.animationTiming=500,this.requestPage=this.defaultRequestPage,this._listeners={},e=a(e),/\/$/.test(e)||(e+="/"),Object.defineProperties(this,{io:{value:t},url:{value:e}}),this._analytics=o}resolveUrl(e){return/^\w+\:/.test(e)?e:a(this.url+e)}disableAll(e=document.body){const t=e.querySelectorAll("a, input, select, textarea, iframe, button, *[focusable], *[tabindex]");for(var r=0;r<t.length;r++){const e=t[r],o=e.getAttribute("tabindex");if("-1"==o)return;e.setAttribute("data-tabindex",o||""),e.setAttribute("data-tabindex","-1")}}enableAll(e=document.body){const t=e.querySelectorAll("*[data-tabindex]");for(var r=0;r<t.length;r++){const e=t[r];e.setAttribute("tabindex",e.getAttribute("data-tabindex")),e.removeAttribute("data-tabindex")}}get analytics(){return this._analytics}set analytics(e){this._analytics=e||o}reportError(e,t){console[t?"error":"warn"](e.stack),this.errorreporter&&this.errorreporter(e,t)}installErrorReporter(e){this.errorreporter=e}registerComponent(e,t){if(t)this.components[e]=t,this.createComponents(document.head),this.createComponents(document.body);else{delete this.components[e];var r=t=>{const r=t.querySelectorAll(e);if(r.length)for(var o=0;o<r.length;o++){const t=r[o];var n=t.__nf_cmapping__;n||(n=t.__nf_cmapping__={});const s=n[e];if(s)try{s.destroy()}catch(e){this.reportError(e)}}};r(document.head),r(document.body)}}unregisterComponent(e,t){}createComponents(e){Object.keys(this.components).forEach(t=>{const r=e.querySelectorAll(t);if(r.length)for(var o=0;o<r.length;o++){const e=r[o];var n=e.__nf_cmapping__;if(n||(n=e.__nf_cmapping__={}),n[t])continue;const s=this.components[t];try{(n[t]=new s).create(e)}catch(e){this.reportError(e)}}})}destroyComponents(e){Object.keys(this.components).forEach(t=>{const r=e.querySelectorAll(t);if(r.length)for(var o=0;o<r.length;o++){const e=r[o];var n=e.__nf_cmapping__;n||(n=e.__nf_cmapping__={});const s=n[t];if(s)try{s.destroy()}catch(e){this.reportError(e)}}})}restoreComponents(e,t){Object.keys(this.components).forEach(r=>{const o=t[r];if(!o)return;const n=e.querySelectorAll(r);if(n.length)for(var s=0;s<n.length;s++){const e=n[s];if(!o.length)break;{const t=o.shift();if(t){var a=e.__nf_cmapping__;a||(a=e.__nf_cmapping__={});var i=a[r];if(!i){const t=this.components[r];try{(i=a[r]=new t).create(e)}catch(e){this.reportError(e),console.warn(e);continue}}try{i.restore(t)}catch(e){this.reportError(e),console.warn(e)}}}}})}saveComponents(e){var t={};return Object.keys(this.components).forEach(r=>{const o=t[r]=[],n=e.querySelectorAll(r);if(n.length)for(var s=0;s<n.length;s++){const e=n[s];var a=e.__nf_cmapping__;a||(a=e.__nf_cmapping__={});var i=a[r];if(!i){const t=this.components[r];try{(i=a[r]=new t).create(e)}catch(e){o.push(void 0),this.reportError(e),console.warn(e);continue}}try{o.push(i.save())}catch(e){o.push(void 0),this.reportError(e),console.warn(e)}}}),t}initPageSystem(o){if(!e)return console.error("The NexusFramework Loader is required for the dynamic Page System to work correctly.");if(!history.pushState||!history.replaceState)return console.warn("This browser is missing an essential feature required for the dynamic Page System.");if(this.pagesyshandler)return console.warn("Page System already initialized, ignoring additional requests to initialize.");o=o||{};const n=this;var s=0;const d=[];this.animationTiming=o.animationTiming||500;const l=o.pageHistoryCacheSize||25e6,h=e=>t=>{const o=t.headers["x-logged-user"];n.currentUserID=o?o[0]:void 0,r("Current UID",n.currentUserID),e(t),200===t.code&&setTimeout(()=>{n._analytics.reportPage()})};e.showError=function(e){const r=location.href.match(f),o=r&&r[1]||location.href,n=e.stack.length,a=l<=n;try{const t=d.length;for(var i=0;i<t;i++){const t=d[i];if(t.url===o)throw a?(d.splice(i,1),s-=t.size):(t.data={error:e},t.updated=+new Date,s+=n-t.size),!0}if(a)throw!0;d.push({url:o,data:{error:e},updated:+new Date,size:n}),s+=n}catch(e){if(!0!==e)throw e}return t(e)};const u={requestPage(t,r,s,a){if(n.pagesysprerequest&&!n.pagesysprerequest(t))return void n.defaultRequestPage(t,s);o.noprogress||(n.disableAll(),e.showProgress());const i=n.resolveUrl(":pagesys/"+t),c=o.noprogress?r:function(t){o.noprogress?r(t):e.showProgress(()=>{r(t),n.enableAll()})};s?window.NexusFrameworkTransport.post(i,s,h(c)):window.NexusFrameworkTransport.get(i,h(c))}};if(o.noio||o.nopagesysio||!this.io)this.pagesysimpl=u;else{const t=this.io;this.pagesysimpl={requestPage(r,s,a,c){if(t.connected){if(n.pagesysprerequest&&!n.pagesysprerequest(r))return void n.defaultRequestPage(r,a);o.noprogress||(n.disableAll(),e.showProgress());const l={referrer:location.href};var d=document.cookie;d&&(l.cookie=d),t.emit("page",a?"POST":"GET",r,a,l,function(t){if(c!=n.activerid)return;const a=t.headers["set-cookie"];a&&a.forEach(function(e){document.cookie=e});const d=o.noprogress?s:function(t){o.noprogress?e.showProgress(()=>{s(t),n.enableAll()}):s(t)};h(d)(i(t,n.resolveUrl(r)))})}else u.requestPage(r,s,a,c)}}}var g,p=document.getElementsByTagName("base");p=p&&p[0],this.pagesysprerequest=o.prerequest,this.pagesyshandler=o.handler||((t,r)=>{try{const e=t.headers["content-type"][0];if(!/\/html(;.+)?$/.test(e.toLowerCase()))throw new Error("Content type is not html")}catch(e){}const o=t.contentAsString,s=o.indexOf("<body");if(-1==s)throw new Error("Could not find start of body tag");const a=o.indexOf("</body>")||o.indexOf("</ body>");if(-1==a)throw new Error("Could not find end of body tag");const i=o.match(/<title>([^<]+)<\/\s*title>/);document.title=i&&i[1]||"Title Not Set";const d=document.createElement("html");var l;d.innerHTML=o.substring(s,a)+"</body>";var h=d.children;const u=[];for(var g=0;g<h.length;g++){const e=h[g];switch(e.nodeName.toUpperCase()){case"HEAD":break;case"BODY":g=-1,h=e.children;break;case"SCRIPT":const t=e.innerHTML.match(/^NexusFrameworkLoader\.load\((.+)\);?$/);t&&(l=JSON.parse(t[1]));break;default:if(c.test(e.className))break;u.push(e)}}if(!u.length)throw new Error("Nothing found in response to add to page");if(!l)throw new Error("NexusFrameworkLoader script not found...");for(g=(h=document.body.children).length-1;g>=0;g--){const e=h[g];switch(e.nodeName.toUpperCase()){case"LINK":case"SCRIPT":break;default:if(c.test(e.className))break;document.body.removeChild(e)}}const p=document.createDocumentFragment();return u.forEach(e=>{p.appendChild(e),this.createComponents(e)}),document.body.appendChild(p),e.load(l,function(){n.progressVisible=!0,e.resetProgress(),r()}),!0});const f=/^([^#]+)(#.*)?$/;var m=location.href.match(f)[1];const w=new RegExp("^"+this.url.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"(.*)$","i");const y=this.requestPage=((t,o,i=!1)=>{const c=t.match(/\.([^\/]+)([\?#].*)?$/);if(c&&"htm"!==c[0]&&"html"!==c[0])this.defaultRequestPage(t,o),r("Ignoring navigation",t,c);else{r("requestPage",t);const h=++n.activerid,u=this.resolveUrl(t),v=u+(c&&c[2]||"");i?history.replaceState(!!o,"Loading...",v):(history.pushState(!!o,"Loading...",v),m=v.match(f)[1],window.scrollTo(0,0)),e.resetError(),e.resetProgress(),this.pagesysimpl.requestPage(t,c=>{try{if(h!==n.activerid)return;if(!c.code)return e.showProgress(void 0,"Connection Issue","Check your network and try again"),document.title="Connection Issue",history.replaceState(c.hadData,"Connection Issue",v),void setTimeout(function(){h===n.activerid&&y(t,o,!0)},9e5);if(502===c.code||503===c.code)return e.showProgress(void 0,"Scheduled Maintenance","Sorry but this website is undergoing scheduled maintenance"),document.title="Scheduled Maintenance",history.replaceState(c.hadData,"Scheduled Maintenance",v),void setTimeout(function(){h===n.activerid&&y(t,o,!0)},9e5);const f=c.headers["x-location"]||c.headers.location;if(f){const e=a(f[0]);return w.test(e)?void this.requestPage(e.substring(this.url.length),void 0,!0):(console.warn("Requested redirect to external url:",e),void(window.location.href=e))}const b=c.headers["content-disposition"];if(b&&"attachment"==b[0].toLowerCase())throw new Error("Attachment disposition");this.pagesyshandler(c,function(){if(h===n.activerid)try{const h=document.title,f=(c.headers["content-type"],c.contentLength),w=l<=f,y=w?void 0:{title:h,user:n.currentUserID,scroll:[window.scrollX,window.scrollY],body:n.saveComponents(document.body),basehref:p?p.href:void 0,response:c};var e;const b=d.length;try{for(e=0;e<b;e++){const t=d[e];if(t.url===u)throw w?(d.splice(e,1),s-=t.size):(t.data=y,t.updated=+new Date,s+=f-t.size),!0}if(!w)throw d.push({url:u,data:y,updated:+new Date,size:f}),s+=f,!0;r("Response too big to store",u,f)}catch(t){if(!0!==t)throw t;{const t=s-l;if(t>0){d.sort(function(e,t){return e.updated-t.updated});var a=0;for(e=0;e<b&&!((a+=d[e].size)>=t);e++);e++,d.splice(0,e),r("Trimmed",e,"items...")}}}history.replaceState(c.hadData,document.title,v),n.emit("page",u,t)}catch(e){if(r(e),i)window.location.reload(!0);else try{m=void 0,g=[t,o],r("Going backwards"),history.go(-1)}catch(e){}}})}catch(e){if(r(e),i)window.location.reload(!0);else try{m=void 0,g=[t,o],r("Going backwards"),history.go(-1)}catch(e){}}},o,h)}});return this.registerComponent("a",class{constructor(){this.handler=(e=>{if(this.element.hasAttribute("data-nopagesys")||this.element.hasAttribute("data-nodynamic"))return;const t=this.element.getAttribute("href");if(!t||!t.length)return;var o=this.element.href;const s=o.match(f);if(!s[2]||m!==s[1])if(w.test(o))try{const t=o.match(/^(.+)#.*$/);t&&(o=t[1]),n.requestPage(o.substring(n.url.length));try{e.stopPropagation()}catch(e){}try{e.preventDefault()}catch(e){}}catch(e){console.warn(e)}else r("Navigating",o)})}create(e){e.addEventListener("click",this.handler),this.element=e}destroy(){this.element.removeEventListener("click",this.handler)}restore(e){}save(){}}),this.registerComponent("form",class{constructor(){this.handler=(t=>{if(this.element.hasAttribute("data-nopagesys")||this.element.hasAttribute("data-nodynamic"))return;const o=this.element.getAttribute("method")||"get",s=this.element.getAttribute("enctype")||"text/urlencoded",i=this.element.getAttribute("action")||"";var c=a(i);if(w.test(c))try{const a=c.match(/^(.+)#.*$/);a&&(c=a[1]);const i=new FormData(this.element);if(e.showProgress(void 0,"Submitting Form","Your form data is being processed"),"post"===o.trim().toLowerCase())n.requestPage(c.substring(n.url.length),{type:s,data:i});else{var d=!0,l=c.substring(n.url.length)+"?";for(var h of i)d?d=!1:l+="&",l+=encodeURIComponent(h[0]),l+="=",l+=encodeURIComponent(h[1]);n.requestPage(l)}try{t.stopPropagation()}catch(t){}try{t.preventDefault()}catch(t){}return Array.prototype.forEach.call(this.element.querySelectorAll("a, input, select, textarea, iframe, button, *[name]"),function(e){e.setAttribute("disabled","disabled"),e.className+=" disabled"}),Array.prototype.forEach.call(this.element.querySelectorAll("button:not([type]), button[type=submit]"),function(e){e.innerHTML="Processing Request"}),void Array.prototype.forEach.call(this.element.querySelectorAll("input[type=submit]"),function(e){e.value="Processing Request"})}catch(t){r(t)}r("Submitting",c)})}create(e){e.addEventListener("submit",this.handler),this.element=e}destroy(){this.element.removeEventListener("submit",this.handler)}restore(e){}save(){}}),window.addEventListener("popstate",o=>{try{var s;const c=location.href.match(f),l=d.length,h=c[1];for(var a=0;a<l;a++){const e=d[a];if(e.url===h){s=e;break}}const u=!!s,p=++n.activerid,y=u&&s.data.error;if(y)return void t(y);if(g){r("forwardPopState",g);const e=g;return setTimeout(()=>{p===n.activerid&&n.defaultRequestPage(e[0],e[1])}),void(g=void 0)}if(m===h)return void r("Only hash has changed...",h);if(console.log(h,m,o),console.trace(),m=c[1],o.state&&alert("You submitted data to this page, which cannot be re-sent. Because of this, what you're viewing may not be the same now."),!u)throw new Error("No state for: "+h+", reloading...");if(s.data.user!=n.currentUserID)throw new Error("User has changed since state was created, reloading...");document.title=s.data.title,e.resetProgress(),e.resetError(),n.pagesyshandler(s.data.response,function(e){if(p===n.activerid)try{if(e)throw e;s.data.body&&n.restoreComponents(document.body,s.data.body),s.data.scroll&&window.scrollTo.apply(window,s.data.scroll),r("Used stored page state!",s)}catch(e){r(e);var t=location.href;if(w.test(t))try{if(/reloading\.\.\.$/.test(e.message))return void n.requestPage(t.substring(n.url.length),void 0,!0);console.error("Unknown error occured, actually navigating to page...")}catch(e){console.error(e)}location.reload(!0)}})}catch(e){r(e);var i=location.href;if(w.test(i))try{if(/reloading\.\.\.$/.test(e.message))return void n.requestPage(i.substring(n.url.length),void 0,!0);console.error("Unknown error occured, actually navigating to page...")}catch(o){console.error(o)}location.reload(!0)}}),!0}defaultRequestPage(e,t){if(t)throw new Error("Posting is not supported without an initialized page system, yet");location.href=this.resolveUrl(e)}on(e,t){var r=this._listeners[e];r?r.push(t):this._listeners[e]=r=[t]}off(e,t){var r,o=this._listeners[e];o&&(r=o.indexOf(t))>-1&&o.splice(r,1)}emit(e,...t){const r=this,o=this._listeners[e];o&&o.forEach(function(e){e.apply(r,t)})}}var l;return l=window.io?class extends d{constructor(t){super(t,window.io({path:"/:io"}));const r=this.io;r.on("connect",function(){r.emit("init",e.requestedResources())})}}:class extends d{constructor(e){super(e)}},Object.defineProperty(window,"NexusFrameworkImpl",{value:l}),l}},NexusFrameworkClient:{configurable:!0,set:function(e){Object.defineProperty(window,"NexusFrameworkClient",{value:e})},get:function(){const e=new window.NexusFrameworkImpl;return Object.defineProperty(window,"NexusFrameworkClient",{value:e}),e}}});
//# sourceMappingURL=nexusframeworkclient.min.js.map