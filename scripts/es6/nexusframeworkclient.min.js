Object.defineProperties(window,{NexusFrameworkTransport:{configurable:!0,set:function(e){Object.defineProperty(window,"NexusFrameworkTransport",{value:e})},get:function(){var e;if("XMLHttpRequest"in window){class t{constructor(e,t){this._url=t,this.request=e}get url(){return this.request.responseURL||this._url}get code(){return this.request.status}get contentLength(){return parseInt(this.request.getResponseHeader("content-length"))||this.request.responseText.length}get contentFromJSON(){return this.parsedJson||(this.parsedJson=JSON.parse(this.request.responseText)),this.parsedJson}get contentAsString(){return this.request.responseText}get headers(){if(!this.processedHeaders){const e=this.processedHeaders={};this.request.getAllResponseHeaders().split(/\r?\n/g).forEach(function(t){const r=t.indexOf(":");var s,o;r>0?(s=t.substring(0,r).trim().toLowerCase(),o=t.substring(r+1).trim()):s=t.trim().toLowerCase();var n=e[s];n||(n=e[s]=[]),o&&n.push(o)})}return this.processedHeaders}}const r=function(e,r,s,o,n,a){const i=new XMLHttpRequest;i.open(e,r,!0),n&&Object.keys(n).forEach(function(e){i.setRequestHeader(e,n[e])}),a&&(i.onprogress=function(e){e.lengthComputable&&e.total&&a(e.loaded,e.total)}),i.onreadystatechange=function(e){i.readyState===XMLHttpRequest.DONE&&o(new t(i,r))},i.send(s)};e={get:function(e,t,s,o){r("GET",e,void 0,t,s,o)},head:function(e,t,s,o){r("HEAD",e,void 0,t,s,o)},post:function(e,t,s,o,n){r("POST",e,t,s,o,n)},put:function(e,t,s,o,n){r("PUT",e,t,s,o,n)},execute:r,del:function(e,t,s,o){r("DELETE",e,void 0,t,s,o)}}}else e={get(e,t,r){t({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},head(e,t,r){t({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},put(e,t,r,s){r({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},post(e,t,r,s){r({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},execute(e,t,r,s,o){s({url:t,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})},del(e,t,r){t({url:e,code:503,get contentFromJSON(){throw new Error("No response to parse.")},contentAsString:"",contentLength:0,headers:{}})}};return Object.defineProperty(window,"NexusFrameworkTransport",{value:e}),e}},NexusFrameworkImpl:{configurable:!0,set:function(e){Object.defineProperty(window,"NexusFrameworkImpl",{value:e})},get:function(){const e=window.NexusFrameworkLoader,t=e.showError,r=function(...e){},s={reportError:function(e,t){if(window.ga)try{window.ga("send","exception",{exDescription:(e.stack||""+e).replace(/\n/g,"\n\t"),exFatal:t})}catch(e){console.warn(e)}},reportEvent:function(e,t,r,s){if(window.ga)try{window.ga("send","event",e,t,r,s)}catch(e){console.warn(e)}},reportPage:function(e){if(window.ga)try{e||(e=location.pathname),window.ga("set","page",e),window.ga("send","pageview")}catch(e){console.warn(e)}}},o=document.createElement("a"),n=location.href.match(/^\w+:/)[0],a=function(e){o.setAttribute("href",e);var t=o.href;return/^\/\//.test(t)&&(t=n+t),t},i=function(e,t=location.href){var r;return"string"==typeof e.data||e.data instanceof String?{url:t,code:e.code,contentAsString:e.data,get contentLength(){return parseInt(e.headers["content-length"]&&e.headers["content-length"][0])||e.data.length},get contentFromJSON(){return r||(r=JSON.parse(e.data)),r},headers:e.headers}:{url:t,code:e.code,get contentAsString(){return r||(r=JSON.stringify(e.data)),r},contentFromJSON:e.data,headers:e.headers,get contentLength(){var t=parseInt(e.headers["content-length"]&&e.headers["content-length"][0]);return t||(r||(r=JSON.stringify(e.data)),r.length)}}},c=/(^|\s)loader\-(progress|error)\-container(\s|$)/;class l{constructor(e="/",t){this.activerid=0,this.components={},this.currentUserID=void 0,this.progressBar=document.getElementsByClassName("loader-progress-bar"),this.progressBarContainer=document.getElementsByClassName("loader-progress-container"),this.progressVisible=!1,this.animationTiming=500,this.requestPage=this.defaultRequestPage,this._listeners={},e=a(e),/\/$/.test(e)||(e+="/"),Object.defineProperties(this,{io:{value:t},url:{value:e}}),this._analytics=s}resolveUrl(e){return/^\w+\:/.test(e)?e:a(this.url+e)}disableAll(e=document.body){const t=e.querySelectorAll("a, input, select, textarea, iframe, button, *[focusable], *[tabindex]");for(var r=0;r<t.length;r++){const e=t[r],s=e.getAttribute("tabindex");if("-1"==s)return;e.setAttribute("data-tabindex",s||""),e.setAttribute("data-tabindex","-1")}}enableAll(e=document.body){const t=e.querySelectorAll("*[data-tabindex]");for(var r=0;r<t.length;r++){const e=t[r];e.setAttribute("tabindex",e.getAttribute("data-tabindex")),e.removeAttribute("data-tabindex")}}fadeInProgress(e){if(this.progressVisible)e&&e();else if(this.progressFadeCallbacks)e&&this.progressFadeCallbacks.push(e);else{for(var t=0;t<this.progressBar.length;t++)try{const e=this.progressBar[t],r=e.className;e.className+=" noani",e.style.width="0%",setTimeout(function(){e.className=r})}catch(e){}if(this.progressBarContainer.length){var r;this.progressFadeCallbacks=[],e&&this.progressFadeCallbacks.push(e);this.progressBarContainer[0];r=setTimeout(()=>{try{clearTimeout(r)}catch(e){}this.progressVisible=!0;const e=this.progressFadeCallbacks;delete this.progressFadeCallbacks,e.forEach(function(e){e()})},this.animationTiming),setTimeout(()=>{for(var e=0;e<this.progressBarContainer.length;e++){const t=this.progressBarContainer[e];/(^|\s)loader\-progress\-visible(\s|$)/.test(t.className)||(t.className=(t.className+" loader-progress-visible").trim())}})}else this.progressVisible=!0,e&&e()}}fadeOutProgress(e){if(this.progressVisible)if(this.progressFadeCallbacks)e&&this.progressFadeCallbacks.push(e);else{for(var t=0;t<this.progressBar.length;t++)this.progressBar[t].style.width="100%";if(this.progressBarContainer.length){var r;this.progressFadeCallbacks=[],e&&this.progressFadeCallbacks.push(e);this.progressBarContainer[0];r=setTimeout(()=>{try{clearTimeout(r)}catch(e){}this.progressVisible=!1;const e=this.progressFadeCallbacks;delete this.progressFadeCallbacks,e.forEach(function(e){e()})},this.animationTiming);for(t=0;t<this.progressBarContainer.length;t++){const e=this.progressBarContainer[t];e.className=e.className.replace(/(^|\s)loader\-progress\-visible(\s|$)/g,function(e){return/^\s.+\s$/.test(e)?" ":""})}}else this.progressVisible=!1,e&&e()}else e&&e()}get analytics(){return this._analytics}set analytics(e){this._analytics=e||s}reportError(e,t){console[t?"error":"warn"](e.stack),this.errorreporter&&this.errorreporter(e,t)}installErrorReporter(e){this.errorreporter=e}registerComponent(e,t){if(t)this.components[e]=t,this.createComponents(document.head),this.createComponents(document.body);else{delete this.components[e];var r=t=>{const r=t.querySelectorAll(e);if(r.length)for(var s=0;s<r.length;s++){const t=r[s];var o=t.__nf_cmapping__;o||(o=t.__nf_cmapping__={});const n=o[e];if(n)try{n.destroy()}catch(e){this.reportError(e)}}};r(document.head),r(document.body)}}unregisterComponent(e,t){}createComponents(e){Object.keys(this.components).forEach(t=>{const r=e.querySelectorAll(t);if(r.length)for(var s=0;s<r.length;s++){const e=r[s];var o=e.__nf_cmapping__;if(o||(o=e.__nf_cmapping__={}),o[t])continue;const n=this.components[t];try{(o[t]=new n).create(e)}catch(e){this.reportError(e)}}})}destroyComponents(e){Object.keys(this.components).forEach(t=>{const r=e.querySelectorAll(t);if(r.length)for(var s=0;s<r.length;s++){const e=r[s];var o=e.__nf_cmapping__;o||(o=e.__nf_cmapping__={});const n=o[t];if(n)try{n.destroy()}catch(e){this.reportError(e)}}})}restoreComponents(e,t){Object.keys(this.components).forEach(r=>{const s=t[r];if(!s)return;const o=e.querySelectorAll(r);if(o.length)for(var n=0;n<o.length;n++){const e=o[n];if(!s.length)break;{const t=s.shift();if(t){var a=e.__nf_cmapping__;a||(a=e.__nf_cmapping__={});var i=a[r];if(!i){const t=this.components[r];try{(i=a[r]=new t).create(e)}catch(e){this.reportError(e),console.warn(e);continue}}try{i.restore(t)}catch(e){this.reportError(e),console.warn(e)}}}}})}saveComponents(e){var t={};return Object.keys(this.components).forEach(r=>{const s=t[r]=[],o=e.querySelectorAll(r);if(o.length)for(var n=0;n<o.length;n++){const e=o[n];var a=e.__nf_cmapping__;a||(a=e.__nf_cmapping__={});var i=a[r];if(!i){const t=this.components[r];try{(i=a[r]=new t).create(e)}catch(e){s.push(void 0),this.reportError(e),console.warn(e);continue}}try{s.push(i.save())}catch(e){s.push(void 0),this.reportError(e),console.warn(e)}}}),t}initPageSystem(s){if(!e)return console.error("The NexusFramework Loader is required for the dynamic Page System to work correctly.");if(!history.pushState||!history.replaceState)return console.warn("This browser is missing an essential feature required for the dynamic Page System.");s=s||{};const o=this;var n=0;const l=[];this.animationTiming=s.animationTiming||500;const h=s.pageHistoryCacheSize||25e6,d=e=>t=>{const s=t.headers["x-logged-user"];this.currentUserID=s?s[0]:void 0,r("Current UID",this.currentUserID),e(t),200===t.code&&setTimeout(()=>{this._analytics.reportPage()})};e.showError=function(e){const r=location.href.match(f),s=r&&r[1]||location.href,o=e.stack.length,a=h<=o;try{const t=l.length;for(var i=0;i<t;i++){const t=l[i];if(t.url===s)throw a?(l.splice(i,1),n-=t.size):(t.data={error:e},t.updated=+new Date,n+=o-t.size),!0}if(a)throw!0;l.push({url:s,data:{error:e},updated:+new Date,size:o}),n+=o}catch(e){if(!0!==e)throw e}t(e)};const u={requestPage(e,t,r,n){if(o.pagesysprerequest&&!o.pagesysprerequest(e))return void o.defaultRequestPage(e,r);s.noprogress||(o.disableAll(),o.fadeInProgress());const a=o.resolveUrl(":pagesys/"+e),i=s.noprogress?t:function(e){o.fadeInProgress(()=>{t(e),o.enableAll()})};r?window.NexusFrameworkTransport.post(a,r,d(i)):window.NexusFrameworkTransport.get(a,d(i))}};if(s.noio||s.nopagesysio||!this.io)this.pagesysimpl=u;else{const e=this.io;this.pagesysimpl={requestPage(t,r,n,a){if(e.connected){if(o.pagesysprerequest&&!o.pagesysprerequest(t))return void o.defaultRequestPage(t,n);s.noprogress||(o.disableAll(),o.fadeInProgress());const l={referrer:location.href};var c=document.cookie;c&&(l.cookie=c),e.emit("page",n?"POST":"GET",t,n,l,function(e){if(a!=o.activerid)return;const n=e.headers["set-cookie"];n&&n.forEach(function(e){document.cookie=e});const c=s.noprogress?r:function(e){o.fadeInProgress(()=>{r(e),o.enableAll()})};d(c)(i(e,o.resolveUrl(t)))})}else u.requestPage(t,r,n,a)}}}var p,g=document.getElementsByTagName("base");g=g&&g[0],this.pagesysprerequest=s.prerequest,this.pagesyshandler=s.handler||(t=>{try{const e=t.headers["content-type"][0];if(!/\/html(;.+)?$/.test(e.toLowerCase()))throw new Error("Content type is not html")}catch(e){}const r=t.contentAsString,s=r.indexOf("<body");if(-1==s)throw new Error("Could not find start of body tag");const n=r.indexOf("</body>")||r.indexOf("</ body>");if(-1==n)throw new Error("Could not find end of body tag");const a=r.match(/<title>([^<]+)<\/\s*title>/);document.title=a&&a[1]||"Title Not Set";const i=document.createElement("html");var l;i.innerHTML=r.substring(s,n)+"</body>";var h=i.children;const d=[];for(var u=0;u<h.length;u++){const e=h[u];switch(e.nodeName.toUpperCase()){case"HEAD":break;case"BODY":u=-1,h=e.children;break;case"SCRIPT":const t=e.innerHTML.match(/^NexusFrameworkLoader\.load\((.+)\);?$/);t&&(l=JSON.parse(t[1]));break;default:if(c.test(e.className))break;d.push(e)}}if(!d.length)throw new Error("Nothing found in response to add to page");if(!l)throw new Error("NexusFrameworkLoader script not found...");for(u=(h=document.body.children).length-1;u>=0;u--){const e=h[u];switch(e.nodeName.toUpperCase()){case"LINK":case"SCRIPT":break;default:if(c.test(e.className))break;document.body.removeChild(e)}}const p=document.createDocumentFragment();return d.forEach(e=>{p.appendChild(e),this.createComponents(e)}),document.body.appendChild(p),e.load(l,function(){o.progressVisible=!0,o.fadeOutProgress()}),!0});const f=/^([^#]+)(#.*)?$/;var m=location.href.match(f);const w=new RegExp("^"+this.url.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"(.*)$","i");return this.requestPage=((t,s,o=!1)=>{const i=t.match(/\.([^\/]+)([\?#].*)?$/);if(i&&"htm"!==i[0]&&"html"!==i[0])this.defaultRequestPage(t,s),r("Ignoring navigation",t,i);else{const c=++this.activerid,d=this.resolveUrl(t),u=d+(i&&i[2]||"");o?history.replaceState(void 0,"Loading...",u):(history.replaceState(void 0,document.title,location.href),history.pushState(void 0,"Loading...",u),window.scrollTo(0,0)),e.resetError(),m=u.match(f),this.pagesysimpl.requestPage(t,e=>{try{if(c!=this.activerid)return;const f=e.headers["x-location"]||e.headers.location;if(f){const e=a(f[0]);return w.test(e)?void this.requestPage(e.substring(this.url.length),void 0,!0):(console.warn("Requested redirect to external url:",e),void(window.location.href=e))}const m=e.headers["content-disposition"];if(m&&"attachment"==m[0].toLowerCase())throw new Error("Attachment disposition");if(!this.pagesyshandler(e))throw new Error("Could not handle response");e.headers["content-type"];r("history.replaceState",document.title);const y=e.contentLength,v=h<=y,b=v?void 0:{title:document.title,user:this.currentUserID,scroll:[window.scrollX,window.scrollY],body:this.saveComponents(document.body),basehref:g?g.href:void 0,response:e};var o;const _=l.length;try{for(o=0;o<_;o++){const e=l[o];if(e.url===d)throw v?(l.splice(o,1),n-=e.size):(e.data=b,e.updated=+new Date,n+=y-e.size),!0}if(!v)throw l.push({url:d,data:b,updated:+new Date,size:y}),n+=y,!0;r("Response too big to store",d,y)}catch(e){if(!0!==e)throw e;{const e=n-h;if(e>0){l.sort(function(e,t){return e.updated-t.updated});var i=0;for(o=0;o<_&&!((i+=l[o].size)>=e);o++);o++,l.splice(0,o),r("Trimmed",o,"items...")}}}history.replaceState(void 0,document.title,u),this.emit("page",d,t)}catch(e){r(e),p=[t,s];try{history.go(-1)}catch(e){}}},s,c)}}),this.registerComponent("a",class{constructor(){this.handler=(e=>{if(this.element.hasAttribute("data-nopagesys")||this.element.hasAttribute("data-nodynamic"))return;const t=this.element.getAttribute("href");if(!t||!t.length)return;var s=this.element.href;const n=s.match(f);if(!(n&&m&&n[2]&&m[1]===n[1]))if(m=n,w.test(s))try{const t=s.match(/^(.+)#.*$/);t&&(s=t[1]),o.requestPage(s.substring(o.url.length));try{e.stopPropagation()}catch(e){}try{e.preventDefault()}catch(e){}}catch(e){console.warn(e)}else r("Navigating",s)})}create(e){e.addEventListener("click",this.handler),this.element=e}destroy(){this.element.removeEventListener("click",this.handler)}restore(e){}save(){}}),window.addEventListener("popstate",s=>{var n;const a=location.href.match(f),i=a[1]||location.href,c=l.length;for(var h=0;h<c;h++){const e=l[h];if(e.url===i){n=e;break}}const d=!!n;if(m&&m[1]===a[1])return void r("Only hash has changed...");m=a,o.activerid++;const u=d&&n.data.error;if(u)t(u);else{if(p){r("forwardPopState",p);const e=p;return setTimeout(()=>{this.defaultRequestPage(e[0],e[1])}),void(p=void 0)}try{if(!d)throw new Error("No state for: "+i+", reloading...");if(n.data.user!=this.currentUserID)throw new Error("User has changed since state was created, reloading...");document.title=n.data.title,this.pagesyshandler(n.data.response),n.data.body&&this.restoreComponents(document.body,n.data.body),n.data.scroll&&window.scrollTo.apply(window,n.data.scroll),r("Used stored page state!",n),e.resetError()}catch(e){r(e);var g=location.href;if(w.test(g))try{if(/reloading\.\.\.$/.test(e.message))return void this.requestPage(g.substring(o.url.length),void 0,!0);console.error("Unknown error occured, actually navigating to page...")}catch(s){console.error(s)}location.reload(!0)}}}),!0}defaultRequestPage(e,t){if(t)throw new Error("Posting is not supported without an initialized page system, yet");location.href=this.resolveUrl(e)}on(e,t){var r=this._listeners[e];r?r.push(t):this._listeners[e]=r=[t]}off(e,t){var r,s=this._listeners[e];s&&(r=s.indexOf(t))>-1&&s.splice(r,1)}emit(e,...t){const r=this,s=this._listeners[e];s&&s.forEach(function(e){e.apply(r,t)})}}var h;return h=window.io?class extends l{constructor(t){super(t,window.io({path:"/:io"}));const r=this.io;r.on("connect",function(){r.emit("init",e.requestedResources())})}}:class extends l{constructor(e){super(e)}},Object.defineProperty(window,"NexusFrameworkImpl",{value:h}),h}},NexusFrameworkClient:{configurable:!0,set:function(e){Object.defineProperty(window,"NexusFrameworkClient",{value:e})},get:function(){const e=new window.NexusFrameworkImpl;return Object.defineProperty(window,"NexusFrameworkClient",{value:e}),e}}});
//# sourceMappingURL=nexusframeworkclient.min.js.map